<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Certifica√ß√£o Claro HFC - PROCISA</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root { 
            --claro-red: #e31a1c; 
            --procisa-blue: #000080; 
            --bg: #f0f2f5; 
            --gold: #f5c518;
        }
        body { 
            font-family: 'Segoe UI', Tahoma, sans-serif; 
            background: var(--bg); 
            display: flex; justify-content: center; align-items: center;
            min-height: 100vh; margin: 0; padding: 20px;
        }
        
        .card { 
            width: 100%; max-width: 650px; background: white; 
            padding: 40px; border-radius: 20px; 
            box-shadow: 0 15px 35px rgba(0,0,0,0.1); text-align: center;
            border-top: 8px solid var(--procisa-blue);
        }

        .logo-procisa { width: 280px; margin-bottom: 20px; }
        
        .btn { 
            display: block; width: 100%; padding: 16px; margin: 12px 0; 
            border: 2px solid #eee; border-radius: 12px; cursor: pointer; 
            background: #fff; color: #333; font-size: 16px; 
            font-weight: 500; text-align: left; padding-left: 20px; transition: 0.2s;
        }
        .btn:hover { border-color: var(--procisa-blue); background: #f8faff; }
        
        .correct { background: #2ecc71 !important; color: white !important; border-color: #27ae60 !important; }
        .wrong { background: #e74c3c !important; color: white !important; border-color: #c0392b !important; }

        .timer-bar { height: 8px; background: #eee; border-radius: 4px; margin: 20px 0; overflow: hidden; }
        .timer-fill { height: 100%; background: var(--claro-red); width: 100%; transition: 1s linear; }
        .low-time { background: #f1c40f !important; }

        .explanation-box { background: #fff9c4; padding: 18px; border-radius: 10px; margin-top: 20px; border-left: 5px solid #fbc02d; text-align: left; color: #444; }
        
        input[type="text"] { 
            width: 85%; padding: 15px; border: 2px solid #ddd; 
            border-radius: 10px; font-size: 18px; margin-bottom: 20px; text-align: center;
        }

        #ranking-list { list-style: none; padding: 0; margin-top: 20px; }
        #ranking-list li { 
            padding: 12px; margin: 5px 0; border-bottom: 1px solid #eee;
            display: flex; justify-content: space-between; font-size: 0.95rem;
        }
        .my-pos { background: #fff3f3; font-weight: bold; border-radius: 8px; color: var(--claro-red); }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="setup" class="card">
        <img src="logo-procisa.png" class="logo-procisa" alt="PROCISA">
        <h2 style="color: var(--procisa-blue);">Certifica√ß√£o T√©cnica HFC</h2>
        <p style="color: #666;">Respostas aleat√≥rias para garantir o aprendizado real.</p>
        <input type="text" id="p-name" placeholder="Digite seu nome completo">
        <button id="btn-iniciar" class="btn" style="background: var(--claro-red); color: white; text-align: center; border: none; font-weight: bold;">COME√áAR AVALIA√á√ÉO</button>
    </div>

    <div id="quiz" class="card hidden">
        <div id="q-info" style="font-weight: bold; color: #999; font-size: 0.8rem; letter-spacing: 1px;"></div>
        <div class="timer-bar"><div id="t-fill" class="timer-fill"></div></div>
        <h3 id="q-text" style="text-align: left; color: #222; margin-bottom: 25px;"></h3>
        <div id="opts"></div>
        <div id="explanation" class="explanation-box hidden"></div>
    </div>

    <div id="result" class="card hidden">
        <h2 style="color: var(--procisa-blue);">Obrigado por realizar o teste!</h2>
        <p style="color: #666;">Sua avalia√ß√£o foi conclu√≠da com sucesso.</p>
        <div style="background: #f8f9fa; padding: 20px; border-radius: 15px; margin: 25px 0;">
            <h1 id="final-score" style="margin: 0; color: var(--claro-red);">0</h1>
            <p style="margin: 5px 0; font-weight: bold;">PONTOS TOTAIS</p>
            <div id="pos-highlight" style="font-size: 1.4rem; color: var(--procisa-blue); margin-top: 10px; border-top: 1px solid #ddd; padding-top: 10px;">
                Voc√™ est√° em <span id="user-rank">--</span> no ranking!
            </div>
        </div>
        <button class="btn" style="background: var(--procisa-blue); color: white; text-align: center; border: none;" onclick="location.reload()">REFAZER PARA MELHORAR MEU RESULTADO üöÄ</button>
        <hr>
        <h4 style="text-align: left; color: #444;">üèÜ QUADRO DE HONRA (TOP 10)</h4>
        <ul id="ranking-list"></ul>
    </div>

    <audio id="snd-correct" src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3"></audio>
    <audio id="snd-wrong" src="https://assets.mixkit.co/active_storage/sfx/1114/1114-preview.mp3"></audio>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
        import { getFirestore, doc, setDoc, collection, query, orderBy, limit, onSnapshot, getDocs } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBq8wjHbbLGh5mlhujzX2b_-FJX4e2AYzk",
            authDomain: "quiz-telecom-claro.firebaseapp.com",
            projectId: "quiz-telecom-claro",
            storageBucket: "quiz-telecom-claro.firebasestorage.app",
            messagingSenderId: "64474953672",
            appId: "1:64474953672:web:58520fea1375adf49532fd"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const QUESTIONS = [
            {q: "Nos casos onde os n√≠veis de sinal n√£o forem suficientes para atender todos os pontos, √© essencial:", o: ["Conferir se n√£o existe problemas com os n√≠veis da Rede Externa e MDU.", "Instruir o cliente para que ele saiba de poss√≠veis problemas em alguns pontos.", "Relatar os n√≠veis inadequados em OS sem orientar o cliente.", "Realizar a instala√ß√£o e informar que ele ligue na CRN."], c: 0, t: 30, e: "Sempre valide a rede externa antes de prosseguir."},
            {q: "Qual o procedimento correto para o t√©cnico finalizar o preenchimento da O.S. DIGITAL?", o: ["Clicar no bot√£o 'adotar e assinar'", "Clicar no bot√£o 'concluir'", "Clicar no bot√£o 'avan√ßar'", "Clicar no bot√£o 'assinar ordem de servi√ßo'"], c: 0, t: 25, e: "O encerramento oficial √© via 'adotar e assinar'."},
            {q: "Com o gravador na Nuvem, os conte√∫dos gravados ficar√£o dispon√≠veis pelo per√≠odo de:", o: ["90 dias", "180 dias", "45 dias", "30 dias"], c: 3, t: 20, e: "O per√≠odo de reten√ß√£o na nuvem √© de 30 dias."},
            {q: "Para o MAC 0023754F1608 na Baixa URA, o caractere hexadecimal (F) exige digitar:", o: ["*6", "*06", "6", "#6"], c: 1, t: 20, e: "O c√≥digo *06 substitui a letra F na URA."},
            {q: "Sobre o teste de TRACERT, √© correto afirmar que:", o: ["Configura o Firewall", "Teste de rota para verificar lentid√£o, bloqueio ou gargalo", "Mede velocidade nominal", "Verifica v√≠rus"], c: 1, t: 30, e: "O tracert rastreia o caminho do pacote para achar falhas."},
            {q: "Download de 7,5MBps equivale a qual velocidade contratada?", o: ["100 Mbps", "12 Mbps", "120 Mbps", "60 Mbps"], c: 3, t: 35, e: "7,5 MBps * 8 = 60 Mbps."},
            {q: "O que √© downstream?", o: ["Sinal que o CMTS envia para o Emta", "Sinal que o Emta envia para o CMTS", "Sinal de retorno", "Sinal do controle"], c: 0, t: 20, e: "√â o fluxo de dados da central para o assinante."},
            {q: "Entrada 15/12. Quais n√≠veis na sa√≠da TAP do DC 06?", o: ["CA: 12.5 / CB 9.5", "CA: 13.5 / CB 10.5", "CA: 15 / CB 12", "CA: 09 / CB 06"], c: 3, t: 40, e: "O DC 6 reduz 6dB exatos na deriva√ß√£o (15-6=9)."},
            {q: "Local de instala√ß√£o do Emta para melhor cobertura Wi-Fi?", o: ["Cozinha", "S√≥t√£o", "C√¥modo central (80% da casa entre -10 a -70dbm)", "Perto do PC"], c: 2, t: 35, e: "A centraliza√ß√£o minimiza √°reas de sombra."},
            {q: "Sobre a fun√ß√£o AUTODESLIGAR nos HDNGs:", o: ["Deve desabilitar", "N√£o desabilitar para manter o decoder atualizado", "Vem desligado", "N√£o existe"], c: 1, t: 25, e: "O standby √© necess√°rio para atualiza√ß√µes de software."}
            // ... (Voc√™ pode adicionar as demais quest√µes aqui)
        ];

        let cur = 0, score = 0, timer, timeLeft, pName = "";

        document.getElementById('btn-iniciar').onclick = () => {
            pName = document.getElementById('p-name').value.trim();
            if(!pName) return alert("INSIRA SEU NOME");
            document.getElementById('setup').classList.add('hidden');
            document.getElementById('quiz').classList.remove('hidden');
            loadQ();
        };

        function loadQ() {
            if(cur >= QUESTIONS.length) return finish();
            const q = QUESTIONS[cur];
            timeLeft = q.t;
            
            document.getElementById('q-info').innerText = `QUEST√ÉO ${cur+1} DE ${QUESTIONS.length}`;
            document.getElementById('q-text').innerText = q.q;
            document.getElementById('explanation').classList.add('hidden');
            
            const box = document.getElementById('opts');
            box.innerHTML = "";

            // LOGICA ALEATORIA: Criamos um array de indices e embaralhamos
            let indices = q.o.map((_, i) => i);
            indices.sort(() => Math.random() - 0.5);

            indices.forEach(idx => {
                const b = document.createElement('button');
                b.className = "btn";
                b.innerText = q.o[idx];
                b.onclick = () => select(idx, b);
                box.appendChild(b);
            });
            runTimer();
        }

        function runTimer() {
            const f = document.getElementById('t-fill');
            f.style.width = "100%";
            f.classList.remove('low-time');
            clearInterval(timer);
            timer = setInterval(() => {
                timeLeft--;
                f.style.width = (timeLeft/QUESTIONS[cur].t*100) + "%";
                if(timeLeft <= 5) f.classList.add('low-time');
                if(timeLeft <= 0) select(-1, null);
            }, 1000);
        }

        function select(idx, b) {
            clearInterval(timer);
            const correctIdx = QUESTIONS[cur].c;
            const btns = document.querySelectorAll('.btn');
            btns.forEach(el => el.style.pointerEvents = "none");

            if(idx === correctIdx) {
                if(b) b.classList.add('correct');
                document.getElementById('snd-correct').play();
                score += (100 + (timeLeft * 10));
                confetti({ particleCount: 40, spread: 60, origin: { y: 0.8 } });
            } else {
                if(b) b.classList.add('wrong');
                document.getElementById('snd-wrong').play();
                // Destaca a correta mesmo estando embaralhada
                btns.forEach(btn => {
                    if(btn.innerText === QUESTIONS[cur].o[correctIdx]) btn.classList.add('correct');
                });
            }

            const exp = document.getElementById('explanation');
            exp.innerText = `üí° ${QUESTIONS[cur].e}`;
            exp.classList.remove('hidden');

            cur++;
            setTimeout(loadQ, 3500);
        }

        async function finish() {
            document.getElementById('quiz').classList.add('hidden');
            document.getElementById('result').classList.remove('hidden');
            document.getElementById('final-score').innerText = score;
            
            await setDoc(doc(db, "ranking", pName + "_" + Date.now()), { name: pName, score: score });
            calculateRank();
        }

        async function calculateRank() {
            const qSnap = await getDocs(query(collection(db, "ranking"), orderBy("score", "desc")));
            let rank = 1;
            qSnap.forEach(d => {
                if(d.data().score > score) rank++;
            });
            document.getElementById('user-rank').innerText = rank + "¬∫ lugar";
        }

        onSnapshot(query(collection(db, "ranking"), orderBy("score", "desc"), limit(10)), (snap) => {
            const list = document.getElementById('ranking-list');
            list.innerHTML = "";
            let i = 1;
            snap.forEach((doc) => {
                const d = doc.data();
                const isMe = (d.name === pName && d.score === score);
                list.innerHTML += `<li class="${isMe ? 'my-pos' : ''}"><span>${i}. ${d.name}</span> <b>${d.score}</b></li>`;
                i++;
            });
        });
    </script>
</body>
</html>
