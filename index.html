<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Certifica√ß√£o Claro HFC - PROCISA</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root { 
            --claro-red: #e31a1c; 
            --procisa-blue: #000080; 
            --bg: #eef2f7; 
            --gold: #ffd700;
            --silver: #c0c0c0;
            --bronze: #cd7f32;
        }
        body { font-family: 'Segoe UI', Roboto, sans-serif; background: var(--bg); display: flex; justify-content: center; padding: 20px; margin: 0; }
        
        /* Design Premium do Cart√£o */
        .card { 
            width: 100%; max-width: 650px; background: rgba(255, 255, 255, 0.95); 
            padding: 40px; border-radius: 24px; 
            box-shadow: 0 20px 40px rgba(0,0,0,0.1); 
            text-align: center; border-top: 10px solid var(--procisa-blue);
            transition: transform 0.3s ease;
        }

        .logo-procisa { width: 300px; margin-bottom: 20px; height: auto; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1)); }
        
        /* Bot√µes Estilizados */
        .btn { 
            display: block; width: 100%; padding: 18px; margin: 12px 0; 
            border: 2px solid #e0e0e0; border-radius: 14px; 
            cursor: pointer; background: #fff; font-size: 16px; font-weight: 600; 
            text-align: left; padding-left: 25px; transition: all 0.2s; 
            line-height: 1.4; color: #333;
        }
        .btn:hover { border-color: var(--procisa-blue); background: #f8faff; transform: translateY(-2px); }
        
        .correct { background: #28a745 !important; color: white !important; border-color: #218838 !important; }
        .wrong { background: #ff6b6b !important; color: white !important; border-color: #fa5252 !important; }

        /* Progress Bar */
        .progress-container { width: 100%; background: #eee; height: 10px; border-radius: 5px; margin-bottom: 20px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--procisa-blue); width: 0%; transition: width 0.5s ease; }

        .timer-bar { height: 6px; background: #eee; border-radius: 3px; margin: 15px 0; overflow: hidden; }
        .timer-fill { height: 100%; background: var(--claro-red); width: 100%; transition: 1s linear; }

        /* Ranking com P√≥dio */
        #ranking-list { list-style: none; padding: 0; margin-top: 20px; }
        #ranking-list li { 
            padding: 15px; margin-bottom: 8px; border-radius: 12px; 
            display: flex; justify-content: space-between; align-items: center;
            background: #fff; border: 1px solid #eee; font-weight: 500;
        }
        .rank-1 { border: 2px solid var(--gold) !important; background: #fffdf0 !important; font-size: 1.2rem; }
        .rank-2 { border: 2px solid var(--silver) !important; }
        .rank-3 { border: 2px solid var(--bronze) !important; }

        .explanation-box { background: #fff9c4; padding: 18px; border-radius: 12px; margin-top: 20px; border-left: 6px solid #fbc02d; text-align: left; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="setup" class="card">
        <img src="logo-procisa.png" class="logo-procisa" alt="Treinamento PROCISA">
        <h2 style="color: var(--procisa-blue); margin-bottom: 10px;">Certifica√ß√£o Claro HFC</h2>
        <p style="color: #666; font-size: 1.1rem; margin-bottom: 30px;">Inicie sua jornada para se tornar um T√©cnico Elite.</p>
        <input type="text" id="p-name" placeholder="Digite seu Nome Completo" style="width: 85%; padding: 15px; border-radius: 12px; border: 2px solid #ddd; font-size: 16px; margin-bottom: 25px;">
        <button id="btn-iniciar" class="btn" style="background: var(--claro-red); color: #fff; border: none; text-align: center; font-size: 1.2rem; box-shadow: 0 4px 15px rgba(227, 26, 28, 0.3);">INICIAR AVALIA√á√ÉO üöÄ</button>
    </div>

    <div id="quiz" class="card hidden">
        <div class="progress-container"><div id="p-fill" class="progress-fill"></div></div>
        <div id="q-info" style="font-weight: bold; color: #888; font-size: 0.9rem;"></div>
        <div class="timer-bar"><div id="t-fill" class="timer-fill"></div></div>
        <h3 id="q-text" style="color: #222; text-align: left; line-height: 1.4; margin-bottom: 25px;"></h3>
        <div id="opts"></div>
        <div id="explanation" class="explanation-box hidden"></div>
    </div>

    <div id="result" class="card hidden">
        <h1 id="trophy" style="font-size: 4rem; margin: 0;">üèÜ</h1>
        <h2 id="final-msg" style="margin-top: 10px;"></h2>
        <p id="badge-msg" style="font-weight: bold; color: var(--procisa-blue);"></p>
        <hr style="border: 0; border-top: 1px solid #eee; margin: 20px 0;">
        <h3 style="color: #444;">üìä TOP 10 MELHORES T√âCNICOS</h3>
        <ul id="ranking-list"></ul>
        <button class="btn" style="text-align: center; background: var(--procisa-blue); color: white;" onclick="location.reload()">REFAZER AVALIA√á√ÉO</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
        import { getFirestore, doc, setDoc, collection, query, orderBy, limit, onSnapshot, deleteDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

        // CONFIGURA√á√ÉO FIREBASE
        const firebaseConfig = {
            apiKey: "AIzaSyBq8wjHbbLGh5mlhujzX2b_-FJX4e2AYzk",
            authDomain: "quiz-telecom-claro.firebaseapp.com",
            projectId: "quiz-telecom-claro",
            storageBucket: "quiz-telecom-claro.firebasestorage.app",
            messagingSenderId: "64474953672",
            appId: "1:64474953672:web:58520fea1375adf49532fd"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // QUEST√ïES DO DOCUMENTO 
        const QUESTIONS = [
            {q: "Nos casos onde os n√≠veis de sinal n√£o forem suficientes para atender todos os pontos, √© essencial:", o: ["Conferir se n√£o existe problemas com os n√≠veis da Rede Externa e MDU.", "Instruir o cliente para que ele saiba de poss√≠veis problemas em alguns pontos.", "Relatar os n√≠veis inadequados em Ordem de Servi√ßo sem orientar o cliente.", "Realizar a instala√ß√£o e informar ao Cliente que ele pode ligar na CRN caso tenha problemas."], c: 0, t: 30, e: "Sempre valide a rede externa antes de prosseguir com n√≠veis baixos[cite: 4, 5]."},
            {q: "Qual o procedimento correto para o t√©cnico finalizar o preenchimento da O.S. DIGITAL? (Quest√£o Antiga)", o: ["Clicar no bot√£o 'adotar e assinar'", "Clicar no bot√£o 'concluir'", "Clicar no bot√£o 'avan√ßar'", "Clicar no bot√£o 'assinar ordem de servi√ßo'"], c: 0, t: 30, e: "O fechamento exige o clique em 'adotar e assinar'[cite: 9, 10]."},
            {q: "Com o gravador na Nuvem, os conte√∫dos gravados ficar√£o dispon√≠veis pelo per√≠odo de:", o: ["90 dias", "180 dias", "45 dias", "30 dias"], c: 3, t: 25, e: "Grava√ß√µes em nuvem expiram em 30 dias[cite: 14, 18]."},
            {q: "Na Baixa URA, para o MAC 0023754F1608, o caractere hexadecimal (F) √©:", o: ["*6", "*06", "6", "#6"], c: 1, t: 20, e: "O c√≥digo hexadecimal F √© representado por *06[cite: 19, 21]."},
            {q: "Sobre o teste de TRACERT, √© correto afirmar:", o: ["Configura o Firewall", "Teste de rota para verificar lentid√£o, bloqueio ou gargalo", "Mede velocidade de download", "Verifica v√≠rus"], c: 1, t: 35, e: "Tracert identifica gargalos na rota de dados[cite: 24, 26]."},
            {q: "Representa baixo potencial de barreira/interfer√™ncia para o sinal de Wi-Fi:", o: ["Madeira e Gesso", "√Ågua e √Årvores", "Concreto e Metal", "Micro-ondas"], c: 0, t: 25, e: "Materiais leves como gesso interferem pouco[cite: 29, 30]."},
            {q: "Qual padr√£o Wi-Fi proporciona a maior velocidade da taxa de transmiss√£o?", o: ["n", "b", "g", "ac"], c: 3, t: 20, e: "O padr√£o 802.11ac √© o mais veloz[cite: 34, 38]."},
            {q: "Site oficial para verificar a velocidade do CLARO V√≠rtua:", o: ["www.brasilbandalarga.com.br", "www.minhaconexao.com.br", "www.rjnet.com.br", "Speedtest"], c: 0, t: 20, e: "Site oficial homologado pela Anatel[cite: 39, 40]."},
            {q: "O que √© PIP (Picture in Picture)?", o: ["Visualizar outro canal em janela pequena simultaneamente", "Transfer√™ncia de arquivos", "Ver fotos no celular", "Pagar fatura"], c: 0, t: 30, e: "Permite ver dois canais na mesma tela[cite: 51, 52, 187]."},
            {q: "Dos padr√µes de criptografia WiFi listados, qual √© o mais seguro?", o: ["RADIUS PSK", "WEP", "WPA + TKIP", "WPA2 + AES"], c: 3, t: 20, e: "WPA2-AES √© o padr√£o de seguran√ßa mais robusto[cite: 57, 60, 132]."},
            {q: "O que √© AutoHit?", o: ["HIT autom√°tico pelo controle em HD e HDMAX", "Reset do decoder", "Busca de canais SD", "Configura√ß√£o de Wi-Fi"], c: 0, t: 25, e: "HIT autom√°tico para decoders HD/HDMAX[cite: 61, 62]."},
            {q: "Qual canal usamos para verifica√ß√£o de endere√ß√°veis (CA ID e SmartCard)?", o: ["250", "252", "270", "272"], c: 2, t: 20, e: "Canal 270 exibe dados para a baixa[cite: 83, 86]."},
            {q: "Para um Decoder ser considerado On-line, o IP deve iniciar em:", o: ["10.x.x.x", "168.x.x.x", "189.x.x.x", "192.x.x.x"], c: 0, t: 25, e: "A rede de ger√™ncia usa IPs da classe 10[cite: 88, 89]."},
            {q: "Qual alternativa apresenta a melhor qualidade de sinal digital?", o: ["BER 1.0 E-05", "BER 1.0 E-07", "BER 2.0 E-08", "BER 9 E-06"], c: 2, t: 30, e: "Menor BER significa sinal mais limpo[cite: 93, 96]."},
            {q: "Taxa de download de 7,5MBps equivale a qual velocidade contratada?", o: ["100 Mbps", "12 Mbps", "120 Mbps", "60 Mbps"], c: 3, t: 35, e: "7,5MBps * 8 bits = 60 Mbps[cite: 103, 107]."},
            {q: "Movimentos que o sinal faz ao entrar no DC de 6:", o: ["Inser√ß√£o / Deriva√ß√£o / Isola√ß√£o", "Deriva√ß√£o / Isola√ß√£o / Inser√ß√£o", "Inser√ß√£o / Inser√ß√£o", "Isola√ß√£o / Isola√ß√£o"], c: 0, t: 30, e: "Componente direcional possui essas 3 perdas[cite: 113, 114]."},
            {q: "Um IP Nateado (CGNAT) come√ßa com:", o: ["192.168", "100.x.x.x", "10.0", "172.16"], c: 1, t: 20, e: "Faixa reservada para CGNAT[cite: 118, 120]."},
            {q: "Se n√£o houver disponibilidade de HP no TAP, o que fazer?", o: ["Usar divisor", "Baixa OS #205 e abrir PE1", "Baixar com #203", "Baixar com #409"], c: 1, t: 35, e: "Obrigat√≥rio abrir PE1 para corre√ß√£o[cite: 133, 136]."},
            {q: "Intensidade ideal de Wi-Fi no Analyzer:", o: ["-10 a -70 dBm", "40 a 52 dBmv", "-12 a +12 dbmv", "Sempre acima de zero"], c: 0, t: 25, e: "N√≠vel ideal para estabilidade de conex√£o[cite: 139, 140]."},
            {q: "Inclina√ß√£o da furadeira para furos externos:", o: ["15¬∞ para baixo", "15¬∞ para cima", "√Çngulo reto", "Furar de fora para dentro"], c: 0, t: 25, e: "Evita entrada de √°gua da chuva[cite: 144, 145]."},
            {q: "O que √© downstream?", o: ["Sinal que o CMTS envia para o Emta", "Sinal que o Emta envia para o CMTS", "Sinal do medidor", "Sinal de retorno"], c: 0, t: 20, e: "Fluxo de dados da central para o assinante[cite: 149, 150]."},
            {q: "Entrada 15/12. Quais n√≠veis na sa√≠da TAP do DC 06?", o: ["12.5 / 9.5", "13.5 / 10.5", "15 / 12", "09 / 06"], c: 3, t: 40, e: "O DC 6 retira 6dB exatos na deriva√ß√£o[cite: 154, 158]."},
            {q: "Entrada 19. No DC 12, quais valores nas sa√≠das OUT e TAP?", o: ["16 / 7", "17 / 8", "18 / 7", "19 / 8"], c: 2, t: 40, e: "Atenua√ß√£o de 12dB no TAP e 1dB em OUT[cite: 159, 162]."},
            {q: "O que √© DOCSIS?", o: ["Padr√£o para interface de transmiss√£o de dados via cabo", "Recep√ß√£o de imagem", "Modem 50 mega", "Decoder HD"], c: 0, t: 20, e: "Protocolo padr√£o para tr√°fego em cabos coaxiais[cite: 164, 165]."},
            {q: "O que acontece se amassarmos o cabo?", o: ["Melhora blindagem", "Altera a imped√¢ncia caracter√≠stica do cabo", "Inverte o tilt", "Satura frequ√™ncia"], c: 1, t: 25, e: "Altera a geometria e os 75 Ohms do cabo[cite: 169, 171]."},
            {q: "Informa√ß√µes essenciais no atendimento de excel√™ncia?", o: ["Telefone do coordenador", "NOW, instru√ß√£o do controle e App MINHA CLARO", "Telefone pessoal", "Apenas o manual"], c: 1, t: 25, e: "Encantar o cliente com recursos digitais[cite: 174, 177]."},
            {q: "Local de instala√ß√£o do Emta para cobertura Wi-Fi?", o: ["Cozinha", "S√≥t√£o", "C√¥modo central (80% da casa -10 a -70dbm)", "Perto do PC"], c: 2, t: 35, e: "Centraliza√ß√£o minimiza √°reas de sombra[cite: 180, 185]."},
            {q: "Qual rede √© adequada para TV 4K Ultra HD via Wi-Fi?", o: ["2.4 GHz", "5 GHz (Menos interfer√™ncia e maior banda)", "AM/FM", "Somente cabo"], c: 1, t: 25, e: "5GHz suporta o alto tr√°fego do 4K[cite: 193, 198]."},
            {q: "O que √© REPLAY TV?", o: ["Gravar NOW", "Recome√ßar evento atual ou acessar retroativos at√© 7 dias", "Repetir gols", "Canais offline"], c: 1, t: 30, e: "Permite ver conte√∫dos de at√© uma semana atr√°s[cite: 199, 203]."},
            {q: "Sobre a fun√ß√£o AUTODESLIGAR nos HDNGs:", o: ["Desabilitar sempre", "N√£o desabilitar para manter o decoder atualizado", "J√° vem desligado", "N√£o existe"], c: 1, t: 25, e: "Essencial para atualiza√ß√µes autom√°ticas de software[cite: 205, 207]."},
            {q: "Melhor qualidade de sinal digital no diagn√≥stico?", o: ["PS 100% / QS 100% / BER -5", "PS 60% / QS 100% / BER -8", "PS 90% / QS 70%", "PS 95% / QS 70%"], c: 1, t: 30, e: "BER -8 indica sinal muito superior a -5[cite: 211, 213]."},
            {q: "O que √© BER?", o: ["Erro de transmiss√£o", "Erro de modula√ß√£o", "Taxa de erro de bit", "N√≠vel de sinal"], c: 2, t: 15, e: "Bit Error Rate: integridade da transmiss√£o digital[cite: 227, 231]."}
        ];

        let cur = 0, score = 0, timer, timeLeft, pName = "";

        // INICIALIZA√á√ÉO
        document.getElementById('btn-iniciar').onclick = function() {
            pName = document.getElementById('p-name').value;
            if(!pName) return alert("Por favor, digite seu nome completo!");
            document.getElementById('setup').classList.add('hidden');
            document.getElementById('quiz').classList.remove('hidden');
            loadQ();
        };

        function loadQ() {
            if(cur >= QUESTIONS.length) return finish();
            const q = QUESTIONS[cur];
            timeLeft = q.t;
            
            // Atualiza Barra de Progresso e Info
            document.getElementById('p-fill').style.width = ((cur / QUESTIONS.length) * 100) + "%";
            document.getElementById('q-info').innerText = `DESAFIO ${cur+1} DE ${QUESTIONS.length}`;
            document.getElementById('q-text').innerText = q.q;
            document.getElementById('explanation').classList.add('hidden');
            
            const box = document.getElementById('opts');
            box.innerHTML = "";
            q.o.forEach((opt, i) => {
                const b = document.createElement('button');
                b.className = "btn";
                b.innerText = opt;
                b.onclick = () => select(i, b);
                box.appendChild(b);
            });
            runTimer();
        }

        function runTimer() {
            const f = document.getElementById('t-fill');
            f.style.width = "100%";
            clearInterval(timer);
            timer = setInterval(() => {
                timeLeft--;
                f.style.width = (timeLeft/QUESTIONS[cur].t*100) + "%";
                if(timeLeft <= 0) select(-1, null);
            }, 1000);
        }

        function select(idx, clickedBtn) {
            clearInterval(timer);
            const correctIdx = QUESTIONS[cur].c;
            const btns = document.querySelectorAll('.btn');
            btns.forEach(b => b.style.pointerEvents = "none");

            if(idx === correctIdx) {
                if(clickedBtn) clickedBtn.classList.add('correct');
                score += (100 + (timeLeft * 10));
                confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
            } else {
                if(clickedBtn) clickedBtn.classList.add('wrong');
                btns[correctIdx].classList.add('correct');
            }

            const expBox = document.getElementById('explanation');
            expBox.innerText = `üí° ${QUESTIONS[cur].e}`;
            expBox.classList.remove('hidden');

            cur++;
            setTimeout(loadQ, 4000);
        }

        async function finish() {
            document.getElementById('quiz').classList.add('hidden');
            document.getElementById('result').classList.remove('hidden');
            
            // Define Selo de Qualidade
            let badge = "T√©cnico Iniciante";
            if(score > 3000) badge = "T√©cnico Especialista HFC üíé";
            if(score > 4500) badge = "Mestre da Rede Claro üèÜ";
            
            document.getElementById('final-msg').innerText = pName;
            document.getElementById('badge-msg').innerText = `SEU N√çVEL: ${badge} (${score} pts)`;
            
            await setDoc(doc(db, "ranking", pName + "_" + Date.now()), { name: pName, score: score });
        }

        // RANKING COM P√ìDIO
        const qRank = query(collection(db, "ranking"), orderBy("score", "desc"), limit(10));
        onSnapshot(qRank, (snap) => {
            const list = document.getElementById('ranking-list');
            list.innerHTML = "";
            let i = 1;
            snap.forEach((doc) => {
                const d = doc.data();
                let rankClass = "";
                let icon = "";
                if(i === 1) { rankClass = "rank-1"; icon = "ü•á "; }
                if(i === 2) { rankClass = "rank-2"; icon = "ü•à "; }
                if(i === 3) { rankClass = "rank-3"; icon = "ü•â "; }
                
                list.innerHTML += `<li class="${rankClass}"><span>${icon}${d.name}</span> <b>${d.score} pts</b></li>`;
                i++;
            });
        });

    </script>
</body>
</html>
